BEGIN
    EXECUTE IMMEDIATE 'DROP MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
CREATE MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS 
(MV_RFRSH_DATE,CLASS_NAME,OBJECT_ID,OBJECT_CODE,SORT_ORDER,
STREAM_NAME,DAYTIME,OIL_IN_WATER,OIL_IN_WATER_UOM,
SUSPENDED_SOLIDS,SUSPENDED_SOLIDS_UOM,OXYGEN,OXYGEN_UOM,
CHLORINE,CHLORINE_UOM,SULPHATE,SULPHATE_UOM,DENSITY,
DENSITY_UOM,RECORD_STATUS,CREATED_BY,CREATED_DATE,
LAST_UPDATED_BY,LAST_UPDATED_DATE,REV_NO,REV_TEXT,REV_EVENT,
APPROVAL_STATE,APPROVAL_BY,APPROVAL_DATE,REC_ID)
TABLESPACE DATA01
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
		   
NOCACHE
NOLOGGING
NOCOMPRESS
NOPARALLEL
BUILD IMMEDIATE
REFRESH FORCE ON DEMAND
WITH PRIMARY KEY
AS 
/* Formatted on 24-Mar-23 3:10:10 PM (QP5 v5.227.12220.39724) */
WITH UOM
     AS (SELECT CLASS_NAME, ATTRIBUTE_NAME, UNIT
           FROM Z_UOM
          WHERE ATTRIBUTE_NAME IN
                   ('OIL_IN_WATER',
                    'SUSPENDED_SOLIDS',
                    'OXYGEN',
                    'CHLORINE',
                    'SULPHATE',
                    'DENSITY'))
SELECT SYSDATE AS MV_RFRSH_DATE,
       A.CLASS_NAME,
       OBJECT_ID,
       OBJECT_CODE,
       SORT_ORDER,
       STREAM_NAME,
       DAYTIME,
       OIL_IN_WATER,
       B.UNIT AS OIL_IN_WATER_UOM,
       SUSPENDED_SOLIDS,
       C.UNIT AS SUSPENDED_SOLIDS_UOM,
       OXYGEN,
       D.UNIT AS OXYGEN_UOM,
       CHLORINE,
       E.UNIT AS CHLORINE_UOM,
       SULPHATE,
       F.UNIT AS SULPHATE_UOM,
       DENSITY,
       G.UNIT AS DENSITY_UOM,
       RECORD_STATUS,
       CREATED_BY,
       CREATED_DATE,
       LAST_UPDATED_BY,
       LAST_UPDATED_DATE,
       REV_NO,
       REV_TEXT,
       REV_EVENT,
       APPROVAL_STATE,
       APPROVAL_BY,
       APPROVAL_DATE,
       REC_ID
  FROM DV_STRM_DAY_WATER_ANALYSIS A
       LEFT OUTER JOIN UOM B
          ON A.CLASS_NAME = B.CLASS_NAME AND B.ATTRIBUTE_NAME = 'OIL_IN_WATER'
       LEFT OUTER JOIN UOM C
          ON A.CLASS_NAME = C.CLASS_NAME AND C.ATTRIBUTE_NAME = 'SUSPENDED_SOLIDS'
       LEFT OUTER JOIN UOM D
          ON A.CLASS_NAME = D.CLASS_NAME AND D.ATTRIBUTE_NAME = 'OXYGEN'
       LEFT OUTER JOIN UOM E
          ON A.CLASS_NAME = E.CLASS_NAME AND E.ATTRIBUTE_NAME = 'CHLORINE'
       LEFT OUTER JOIN UOM F
          ON A.CLASS_NAME = F.CLASS_NAME AND F.ATTRIBUTE_NAME = 'SULPHATE'
       LEFT OUTER JOIN UOM G
          ON A.CLASS_NAME = G.CLASS_NAME AND G.ATTRIBUTE_NAME = 'DENSITY';


COMMENT ON MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS IS 'snapshot table for snapshot ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS';

CREATE OR REPLACE SYNONYM ENERGYX_USA.MV_STRM_DAY_WATER_ANALYSIS FOR ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS;

CREATE OR REPLACE SYNONYM EMECCT.MV_STRM_DAY_WATER_ANALYSIS FOR ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS;

CREATE OR REPLACE SYNONYM DASHBOARD.MV_STRM_DAY_WATER_ANALYSIS FOR ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS;

CREATE UNIQUE INDEX ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS_PK ON ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS
(OBJECT_ID, DAYTIME, OIL_IN_WATER_UOM, SUSPENDED_SOLIDS_UOM, OXYGEN_UOM,DENSITY_UOM)
LOGGING
TABLESPACE DATA01
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;

GRANT SELECT, READ ON ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS TO APP_READ_ROLE_USA;

GRANT DELETE, INSERT, SELECT, UPDATE ON ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS TO APP_WRITE_ROLE_USA;

GRANT SELECT ON ECKERNEL_USA.MV_STRM_DAY_WATER_ANALYSIS TO INTERFACE_READ_ROLE;
