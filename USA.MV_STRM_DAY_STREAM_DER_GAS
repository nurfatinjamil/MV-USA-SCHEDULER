BEGIN
    EXECUTE IMMEDIATE 'DROP MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
CREATE MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS 
(
MV_RFRSH_DATE,
CLASS_NAME,
OBJECT_ID,
OBJECT_CODE,
DAYTIME,
SORT_ORDER,
STREAM_NAME,
GRS_VOL_GAS,
GRS_VOL_GAS_UOM,
GRS_VOL_GAS_KSCF,
GRS_VOL_GAS_KSCF_UOM,
RECORD_STATUS,
CREATED_BY,
CREATED_DATE,
LAST_UPDATED_BY,
LAST_UPDATED_DATE,
REV_NO)
TABLESPACE DATA01
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOCACHE
NOLOGGING
NOCOMPRESS
NOPARALLEL
BUILD DEFERRED
REFRESH COMPLETE ON DEMAND
WITH PRIMARY KEY
AS 
/* Formatted on 24-Mar-23 3:02:28 PM (QP5 v5.227.12220.39724) */
WITH UOM
     AS (SELECT CLASS_NAME, ATTRIBUTE_NAME, UNIT
           FROM Z_UOM
          WHERE ATTRIBUTE_NAME IN ('GRS_VOL_GAS'))
SELECT SYSDATE AS MV_RFRSH_DATE,
       'STRM_DAY_STREAM_DER_GAS' AS CLASS_NAME,
       X.OBJECT_ID,
       X.OBJECT_CODE,
       X.DAYTIME,
       X.SORT_ORDER,
       X.STREAM_NAME,
       Y.GRS_VOL AS GRS_VOL_GAS,
       A.UNIT AS GRS_VOL_GAS_UOM,
       ECDP_UNIT.convertValue (Y.GRS_VOL,
                               'KSM3',
                               'KSCF',
                               X.DAYTIME)
          AS GRS_VOL_GAS_KSCF,
       'KSCF' AS GRS_VOL_GAS_KSCF_UOM,
       Y.RECORD_STATUS,
       Y.CREATED_BY,
       Y.CREATED_DATE,
       Y.LAST_UPDATED_BY,
       Y.LAST_UPDATED_DATE,
       Y.REV_NO
  FROM (SELECT S.OBJECT_ID,
               S.OBJECT_CODE,
               SD.DAYTIME,
               SSL.SORT_ORDER,
               SV.NAME AS STREAM_NAME
          FROM STRM_SET_LIST SSL,
               STRM_VERSION SV,
               SYSTEM_DAYS SD,
               STREAM S
         WHERE     s.object_id = sv.object_id
               AND S.OBJECT_ID = SSL.OBJECT_ID
               AND sd.daytime >= sv.daytime
               AND sd.daytime < NVL (sv.end_date, sd.daytime + 1)
               AND sv.stream_type IN ('D', 'C')
               AND sd.daytime >= SSL.FROM_DATE
               AND sd.daytime < NVL (SSL.end_date, sd.daytime + 1)
               AND ssl.stream_set = 'PO.0002_02') X
       LEFT OUTER JOIN EM_STRM_DAY_STREAM Y
          ON X.OBJECT_ID = Y.OBJECT_ID AND X.DAYTIME = Y.PRODUCTION_DAY
       LEFT OUTER JOIN STRM_DAY_ALLOC Z
          ON X.OBJECT_ID = Z.OBJECT_ID AND X.DAYTIME = Z.DAYTIME
       LEFT OUTER JOIN UOM A
          ON 'STRM_DAY_STREAM_DER_GAS' = A.CLASS_NAME AND A.ATTRIBUTE_NAME = 'GRS_VOL_GAS';


COMMENT ON MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS IS 'snapshot table for snapshot ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS';

CREATE OR REPLACE SYNONYM ENERGYX_USA.MV_STRM_DAY_STREAM_DER_GAS FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS;

CREATE OR REPLACE SYNONYM EMECCT.MV_STRM_DAY_STREAM_DER_GAS FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS;

CREATE OR REPLACE SYNONYM DASHBOARD.MV_STRM_DAY_STREAM_DER_GAS FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS;

CREATE UNIQUE INDEX ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS_PK ON ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS
(OBJECT_ID, DAYTIME)
LOGGING
TABLESPACE DATA01
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;

GRANT READ ON ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS TO APP_READ_ROLE_USA;

GRANT DELETE, INSERT, SELECT, UPDATE ON ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS TO APP_WRITE_ROLE_USA;

GRANT READ ON ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_GAS TO INTERFACE_READ_ROLE;