BEGIN
    EXECUTE IMMEDIATE 'DROP MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
CREATE MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL 
(
MV_RFRSH_DATE,
CLASS_NAME,
OBJECT_ID,
OBJECT_CODE,
STREAM_NAME,
DAYTIME,
SORT_ORDER,
GRS_VOL_OIL,
GRS_VOL_OIL_UOM,
GRS_VOL_OIL_KBL,
GRS_VOL_OIL_KBL_UOM,
BS_W,
BS_W_UOM,
NET_VOL_OIL,
NET_VOL_OIL_UOM,
NET_VOL_OIL_KBL,
NET_VOL_OIL_KBL_UOM,
ALLOC_NET_VOL,
ALLOC_NET_VOL_UOM,
DILUENT_CUT,
DILUENT_CUT_UOM,
CALC_DILUENT_VOL,
CALC_DILUENT_VOL_UOM,
CALC_SHRUNK_VOL,
CALC_SHRINK_FACTOR,
CALC_DILUENT_CUT,
CALC_DILUENT_CUT_UOM,
YDAY_GRS_VOL,
YDAY_GRS_VOL_UOM,
MTH_AVG_GRS_VOL,
MTH_AVG_GRS_VOL_UOM,
OIL_SG,
RECORD_STATUS,
CREATED_BY,
CREATED_DATE,
LAST_UPDATED_BY,
LAST_UPDATED_DATE,
REV_NO,
REV_TEXT,
REV_EVENT,
APPROVAL_STATE,
APPROVAL_BY,
APPROVAL_DATE,
REC_ID
)
TABLESPACE DATA01
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOCACHE
NOLOGGING
NOCOMPRESS
NOPARALLEL
BUILD IMMEDIATE
REFRESH FORCE ON DEMAND
WITH PRIMARY KEY
AS 
/* Formatted on 24-Mar-23 3:07:29 PM (QP5 v5.227.12220.39724) */
WITH UOM
     AS (SELECT CLASS_NAME, ATTRIBUTE_NAME, UNIT
           FROM Z_UOM
          WHERE ATTRIBUTE_NAME IN
                   ('GRS_VOL_OIL',
                    'BS_W',
                    'NET_VOL_OIL',
                    'ALLOC_NET_VOL',
                    'DILUENT_CUT',
                    'CALC_DILUENT_VOL',
                    'CALC_SHRUNK_VOL',
                    'CALC_SHRINK_FACTOR',
                    'CALC_DILUENT_CUT',
                    'YDAY_GRS_VOL',
                    'MTH_AVG_GRS_VOL',
                    'OIL_SG'))
SELECT SYSDATE AS MV_RFRSH_DATE,
       A.CLASS_NAME,
       A.OBJECT_ID,
       A.OBJECT_CODE,
       A.STREAM_NAME,
       A.DAYTIME,
       A.SORT_ORDER,
       A.GRS_VOL_OIL,
       B.UNIT AS GRS_VOL_OIL_UOM,
       ecdp_unit.CONVERTVALUE (A.GRS_VOL_OIL,
                               'SM3',
                               'KBBL',
                               A.daytime)
          AS GRS_VOL_OIL_KBL,
       'KBBL' AS GRS_VOL_OIL_KBL_UOM,
       A.BS_W,
       C.UNIT AS BS_W_UOM,
       A.NET_VOL_OIL,
       D.UNIT AS NET_VOL_OIL_UOM,
       ecdp_unit.CONVERTVALUE (A.NET_VOL_OIL,
                               'SM3',
                               'KBBL',
                               A.daytime)
          AS NET_VOL_OIL_KBL,
       'KBBL' AS NET_VOL_OIL_KBL_UOM,
       A.ALLOC_NET_VOL,
       E.UNIT AS ALLOC_NET_VOL_UOM,
       A.DILUENT_CUT,
       F.UNIT AS DILUENT_CUT_UOM,
       A.CALC_DILUENT_VOL,
       G.UNIT AS CALC_DILUENT_VOL_UOM,
       A.CALC_SHRUNK_VOL,
       A.CALC_SHRINK_FACTOR,
       A.CALC_DILUENT_CUT,
       H.UNIT AS CALC_DILUENT_CUT_UOM,
       A.YDAY_GRS_VOL,
       I.UNIT AS YDAY_GRS_VOL_UOM,
       A.MTH_AVG_GRS_VOL,
       J.UNIT AS MTH_AVG_GRS_VOL_UOM,
       A.OIL_SG,
       A.RECORD_STATUS,
       A.CREATED_BY,
       A.CREATED_DATE,
       A.LAST_UPDATED_BY,
       A.LAST_UPDATED_DATE,
       A.REV_NO,
       A.REV_TEXT,
       A.REV_EVENT,
       A.APPROVAL_STATE,
       A.APPROVAL_BY,
       A.APPROVAL_DATE,
       A.REC_ID
  FROM DV_STRM_DAY_STREAM_MEAS_OIL A
       LEFT OUTER JOIN UOM B
          ON A.CLASS_NAME = B.CLASS_NAME AND B.ATTRIBUTE_NAME = 'GRS_VOL_OIL'
       LEFT OUTER JOIN UOM C
          ON A.CLASS_NAME = C.CLASS_NAME AND C.ATTRIBUTE_NAME = 'BS_W'
       LEFT OUTER JOIN UOM D
          ON A.CLASS_NAME = D.CLASS_NAME AND D.ATTRIBUTE_NAME = 'NET_VOL_OIL'
       LEFT OUTER JOIN UOM E
          ON A.CLASS_NAME = E.CLASS_NAME AND E.ATTRIBUTE_NAME = 'ALLOC_NET_VOL'
       LEFT OUTER JOIN UOM F
          ON A.CLASS_NAME = F.CLASS_NAME AND F.ATTRIBUTE_NAME = 'DILUENT_CUT'
       LEFT OUTER JOIN UOM G
          ON A.CLASS_NAME = G.CLASS_NAME AND G.ATTRIBUTE_NAME = 'CALC_DILUENT_VOL'
       LEFT OUTER JOIN UOM H
          ON A.CLASS_NAME = H.CLASS_NAME AND H.ATTRIBUTE_NAME = 'CALC_DILUENT_CUT'
       LEFT OUTER JOIN UOM I
          ON A.CLASS_NAME = I.CLASS_NAME AND I.ATTRIBUTE_NAME = 'YDAY_GRS_VOL'
       LEFT OUTER JOIN UOM J
          ON A.CLASS_NAME = J.CLASS_NAME AND J.ATTRIBUTE_NAME = 'MTH_AVG_GRS_VOL';


COMMENT ON MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL IS 'snapshot table for snapshot ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL';

CREATE OR REPLACE SYNONYM ENERGYX_USA.MV_STRM_DAY_STREAM_MEAS_OIL FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL;

CREATE OR REPLACE SYNONYM EMECCT.MV_STRM_DAY_STREAM_MEAS_OIL FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL;

CREATE OR REPLACE SYNONYM DASHBOARD.MV_STRM_DAY_STREAM_MEAS_OIL FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL;

CREATE UNIQUE INDEX ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL_PK ON ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL
(OBJECT_ID, DAYTIME)
LOGGING
TABLESPACE DATA01
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;

GRANT READ ON ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL TO APP_READ_ROLE_USA;

GRANT DELETE, INSERT, SELECT, UPDATE ON ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL TO APP_WRITE_ROLE_USA;

GRANT READ ON ECKERNEL_USA.MV_STRM_DAY_STREAM_MEAS_OIL TO INTERFACE_READ_ROLE;