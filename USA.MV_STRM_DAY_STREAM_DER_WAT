BEGIN
    EXECUTE IMMEDIATE 'DROP MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
CREATE MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT 
(MV_RFRSH_DATE,CLASS_NAME,OBJECT_ID,OBJECT_CODE,STREAM_NAME,
DAYTIME,SORT_ORDER,GRS_VOL_WAT,GRS_VOL_UOM,GRS_VOL_WAT_KBL,
GRS_VOL_WAT_KBL_UOM,RECORD_STATUS,CREATED_BY,CREATED_DATE,
LAST_UPDATED_BY,LAST_UPDATED_DATE,REV_NO)
TABLESPACE DATA01
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOCACHE
NOLOGGING
NOCOMPRESS
NOPARALLEL
BUILD IMMEDIATE
REFRESH FORCE ON DEMAND
WITH PRIMARY KEY
AS 
/* Formatted on 24-Mar-23 3:04:07 PM (QP5 v5.227.12220.39724) */
WITH UOM
     AS (SELECT CLASS_NAME, ATTRIBUTE_NAME, UNIT
           FROM Z_UOM
          WHERE ATTRIBUTE_NAME IN ('GRS_VOL_WAT'))
SELECT SYSDATE AS MV_RFRSH_DATE,
       'STRM_DAY_STREAM_DER_WAT' AS CLASS_NAME,
       X.OBJECT_ID,
       X.OBJECT_CODE,
       X.STREAM_NAME,
       X.DAYTIME,
       X.SORT_ORDER,
       Y.GRS_VOL AS GRS_VOL_WAT,
       A.UNIT AS GRS_VOL_UOM,
       ECDP_UNIT.convertValue (Y.GRS_VOL,
                               'M3',
                               'KBBL',
                               X.DAYTIME)
          AS GRS_VOL_WAT_KBL,
       'KBBL' AS GRS_VOL_WAT_KBL_UOM,
       Y.RECORD_STATUS,
       Y.CREATED_BY,
       Y.CREATED_DATE,
       Y.LAST_UPDATED_BY,
       Y.LAST_UPDATED_DATE,
       Y.REV_NO
  FROM (SELECT S.OBJECT_ID,
               S.OBJECT_CODE,
               SD.DAYTIME,
               SSL.SORT_ORDER,
               SV.NAME AS STREAM_NAME
          FROM STRM_SET_LIST SSL,
               STRM_VERSION SV,
               SYSTEM_DAYS SD,
               STREAM S
         WHERE     s.object_id = sv.object_id
               AND S.OBJECT_ID = SSL.OBJECT_ID
               AND sd.daytime >= sv.daytime
               AND sd.daytime < NVL (sv.end_date, sd.daytime + 1)
               AND sv.stream_type IN ('D', 'C')
               AND sd.daytime >= SSL.FROM_DATE
               AND sd.daytime < NVL (SSL.end_date, sd.daytime + 1)
               AND ssl.stream_set = 'PO.0003_02') X
       LEFT OUTER JOIN EM_STRM_DAY_STREAM Y
          ON X.OBJECT_ID = Y.OBJECT_ID AND X.DAYTIME = Y.PRODUCTION_DAY
       LEFT OUTER JOIN
       UOM A
          ON     'STRM_DAY_STREAM_DER_WAT' = A.CLASS_NAME
             AND A.ATTRIBUTE_NAME = 'GRS_VOL_WAT';


COMMENT ON MATERIALIZED VIEW ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT IS 'snapshot table for snapshot ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT';

CREATE OR REPLACE SYNONYM ENERGYX_USA.MV_STRM_DAY_STREAM_DER_WAT FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT;

CREATE OR REPLACE SYNONYM EMECCT.MV_STRM_DAY_STREAM_DER_WAT FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT;

CREATE OR REPLACE SYNONYM DASHBOARD.MV_STRM_DAY_STREAM_DER_WAT FOR ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT;

CREATE UNIQUE INDEX ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT_PK ON ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT
(OBJECT_ID, DAYTIME)
LOGGING
TABLESPACE DATA01
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;

GRANT READ ON ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT TO APP_READ_ROLE_USA;

GRANT DELETE, INSERT, SELECT, UPDATE ON ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT TO APP_WRITE_ROLE_USA;

GRANT READ ON ECKERNEL_USA.MV_STRM_DAY_STREAM_DER_WAT TO INTERFACE_READ_ROLE;